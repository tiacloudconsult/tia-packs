---
    version: "1.0"

    description: A workflow to configure target Cluster onto ArgoCD cluster.

    input:
      - input_vars
      - config_template
      - config_file
      - yaml_template
      - yaml_file
      - argocdApp_template
      - argocdApp_file
      - git_branch
      - user_role: "Admin"
    tasks:
      configGen:
        action: argocd_trigger.configGen
        input:
          input_vars: <% ctx().input_vars %>
          config_template: <% ctx().config_template %>
          config_file: <% ctx().config_file %>
          git_branch: <% ctx().git_branch %>
        next:
          - when: <% succeeded() %>
            do:
              - yamlGen
          - when: <% failed() %>
            do:
              - no_operation
      
      yamlGen:
        action: argocd_trigger.yamlGen
        input:
          input_vars: <% ctx().input_vars %>
          yaml_template: <% ctx().yaml_template %>
          yaml_file: <% ctx().yaml_file %>
          git_branch: <% ctx().git_branch %>
        next:
          - when: <% succeeded() %>
            do:
              - argocdAppGen
          - when: <% failed() %>
            do:
              - no_operation

      argocdAppGen:
        action: argocd_trigger.argocdappGen
        input:
          input_vars: <% ctx().input_vars %>
          argocdapp_template: <% ctx().argocdapp_template %>
          argocdapp_file: <% ctx().argocdapp_file %>
          git_branch: <% ctx().git_branch %>
        next:
          - when: <% succeeded() %>
            do:
              - no_operation
          - when: <% failed() %>
            do:
              - no_operation

      no_operation:
        action: core.noop



